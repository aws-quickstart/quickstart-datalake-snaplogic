{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Create Oodle Security Groups (qs-1nrlpbhnk)",
    "Parameters": {
		"BastionSecurityGroupID": {
            "Description": "Bastion Server Security Group.",
            "Type": "String"
		},
        "RedshiftSecurityGroupID": {
            "Description": "Redshift Security Group.",
            "Type": "String"
        },
        "RedshiftPort": {
            "Description": "RedShift Port",
            "Type": "String"
        },
        "CloudplexserverSecurityGroupID": {
            "Description": "Cloudplexserver Security Group.",
            "Type": "String"
        }
    },
    "Mappings": {
    },
    "Conditions": {
        "BastionCondition": {
            "Fn::Not": [
                { "Fn::Equals": [ "", { "Ref": "BastionSecurityGroupID" } ] }
            ]
        },
        "RedshiftCondition": {
            "Fn::Not": [
                { "Fn::Equals": [ "", { "Ref": "RedshiftSecurityGroupID" } ] }
            ]
        },
        "CloudplexserverCondition": {
            "Fn::Not": [
                { "Fn::Equals": [ "", { "Ref": "CloudplexserverSecurityGroupID" } ] }
            ]
        },
        "BastionCloudplexserverCondition": {
            "Fn::And": [
                { "Condition": "BastionCondition" },
                { "Condition": "CloudplexserverCondition" }
            ]
        },
        "CloudplexserverRedshiftCondition": {
            "Fn::And": [
                { "Condition": "CloudplexserverCondition" },
                { "Condition": "RedshiftCondition" }
            ]
        },
        "BastionRedshiftCondition": {
            "Fn::And": [
                { "Condition": "BastionCondition" },
                { "Condition": "RedshiftCondition" }
            ]
        }
    },
    "Resources": {
        "CloudplexserverIngressBastionSsh": {
            "Type": "AWS::EC2::SecurityGroupIngress",
            "Condition": "BastionCloudplexserverCondition",
            "Properties": {
                "GroupId": { "Ref": "CloudplexserverSecurityGroupID" },
                "SourceSecurityGroupId": { "Ref": "BastionSecurityGroupID" },
                "IpProtocol": "tcp",
                "FromPort": "22",
                "ToPort": "22"
            }
        },
        "RedshiftIngressBastion": {
            "Type": "AWS::EC2::SecurityGroupIngress",
            "Condition": "BastionRedshiftCondition",
            "Properties": {
                "GroupId": {
                    "Ref": "RedshiftSecurityGroupID"
                },
                "IpProtocol": "tcp",
                "FromPort": { "Ref": "RedshiftPort" },
                "ToPort": { "Ref": "RedshiftPort" },
                "SourceSecurityGroupId": {
                    "Ref": "BastionSecurityGroupID"
                }
            }
        },
        "RedshiftIngressCloudplexserver": {
            "Type": "AWS::EC2::SecurityGroupIngress",
            "Condition": "CloudplexserverRedshiftCondition",
            "Properties": {
                "GroupId": {
                    "Ref": "RedshiftSecurityGroupID"
                },
                "IpProtocol": "tcp",
                "FromPort": { "Ref": "RedshiftPort" },
                "ToPort": { "Ref": "RedshiftPort" },
                "SourceSecurityGroupId": {
                    "Ref": "CloudplexserverSecurityGroupID"
                }
            }
        }
    },
    "Outputs": {
<<<<<<< HEAD
=======
	"BastionSecurityGroupID": {
            "Value": { "Ref": "BastionSecurityGroup" },
            "Description": "Bastion Security Group ID"
        },
		"RedshiftSecurityGroupID": {
            "Value": { "Fn::GetAtt": [ "RedshiftSecurityGroup", "GroupId" ] },
            "Export": { "Name": { "Fn::Sub": "${AWS::StackName}:RedshiftSecurityGroupID" } }
        },
		 "CloudplexserverSecurityGroupID": {
            "Description": "Cloudplexserver security group.",
            "Value": { "Ref": "CloudplexserverSecurityGroup" },
            "Export": { "Name": { "Fn::Sub": "${AWS::StackName}:CloudplexserverSecurityGroupID" } }
        }
>>>>>>> 031fbe0f35097d38a1fd43d0d293424ca6753878
    }
}
